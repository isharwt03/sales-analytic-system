<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sales Analytics System</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet"/>
<style>
:root{
  /* accent colours ‚Äì same for both modes */
  --accent:#4f8dff;
  --accent2:#00e5c3;
  --accent3:#ff6b6b;
  --accent4:#ffd166;
  --green:#22c55e;
  --red:#ef4444;
  --radius:14px;
  --font:'Syne',sans-serif;
  --mono:'DM Mono',monospace;
  --transition-theme:background .3s,color .3s,border-color .3s,box-shadow .3s;
}

/* ‚îÄ‚îÄ DARK MODE (default) ‚îÄ‚îÄ */
:root,[data-theme="dark"]{
  --bg:#07080f;
  --surface:#0e1120;
  --card:#13162a;
  --border:#1e2340;
  --text:#e8eaf6;
  --muted:#636b9a;
  --shadow:0 4px 24px rgba(0,0,0,.5);
  --chart-grid:rgba(30,35,64,.7);
  --chart-text:#636b9a;
  --table-hover:rgba(79,141,255,.04);
  --table-head:rgba(79,141,255,.08);
  --table-row:rgba(30,35,64,.6);
  --input-bg:#0e1120;
  --scrollbar:#1e2340;
}

/* ‚îÄ‚îÄ LIGHT MODE ‚îÄ‚îÄ */
[data-theme="light"]{
  --bg:#f0f2f8;
  --surface:#ffffff;
  --card:#ffffff;
  --border:#dde1f0;
  --text:#1a1d2e;
  --muted:#7b82a8;
  --shadow:0 4px 24px rgba(100,110,180,.12);
  --chart-grid:rgba(200,205,230,.6);
  --chart-text:#7b82a8;
  --table-hover:rgba(79,141,255,.05);
  --table-head:rgba(79,141,255,.06);
  --table-row:rgba(200,205,230,.4);
  --input-bg:#f7f8fc;
  --scrollbar:#dde1f0;
}

/* ‚îÄ‚îÄ SYSTEM auto preference (applied before JS loads) ‚îÄ‚îÄ */
@media(prefers-color-scheme:light){
  :root:not([data-theme]){
    --bg:#f0f2f8;--surface:#ffffff;--card:#ffffff;--border:#dde1f0;
    --text:#1a1d2e;--muted:#7b82a8;--shadow:0 4px 24px rgba(100,110,180,.12);
    --chart-grid:rgba(200,205,230,.6);--chart-text:#7b82a8;
    --table-hover:rgba(79,141,255,.05);--table-head:rgba(79,141,255,.06);
    --table-row:rgba(200,205,230,.4);--input-bg:#f7f8fc;--scrollbar:#dde1f0;
  }
}

/* smooth theme transition on everything */
*{transition:var(--transition-theme);margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:var(--font);min-height:100vh;display:flex}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar{width:240px;min-height:100vh;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;top:0;left:0;z-index:100}
.logo{padding:24px 20px;border-bottom:1px solid var(--border)}
.logo-mark{display:flex;align-items:center;gap:10px}
.logo-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px}
.logo-text{font-size:15px;font-weight:800;letter-spacing:-.3px}
.logo-sub{font-size:10px;color:var(--muted);font-family:var(--mono);letter-spacing:1px;margin-top:1px}
.nav{flex:1;padding:16px 12px}
.nav-section{font-size:10px;color:var(--muted);font-family:var(--mono);letter-spacing:2px;padding:8px 8px 6px;margin-top:8px}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;transition:.2s;font-size:14px;font-weight:500;color:var(--muted);margin-bottom:2px;border:1px solid transparent}
.nav-item:hover{background:var(--card);color:var(--text)}
.nav-item.active{background:rgba(79,141,255,.12);color:var(--accent);border-color:rgba(79,141,255,.2)}
.nav-icon{font-size:16px;width:20px;text-align:center}
.sidebar-footer{padding:16px;border-top:1px solid var(--border)}
.user-chip{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--card);border-radius:10px}
.avatar{width:32px;height:32px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700}
.user-info{font-size:13px;font-weight:600}
.user-role{font-size:11px;color:var(--muted);font-family:var(--mono)}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main{margin-left:240px;flex:1;min-height:100vh;display:flex;flex-direction:column}
.topbar{padding:20px 32px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:var(--surface);position:sticky;top:0;z-index:50}
.page-title{font-size:20px;font-weight:700}
.page-sub{font-size:12px;color:var(--muted);font-family:var(--mono);margin-top:2px}
.topbar-right{display:flex;align-items:center;gap:12px}
.date-chip{padding:6px 14px;background:var(--card);border:1px solid var(--border);border-radius:8px;font-size:12px;font-family:var(--mono);color:var(--muted)}
.btn{padding:8px 18px;border-radius:9px;font-size:13px;font-weight:600;font-family:var(--font);cursor:pointer;transition:.2s;border:none}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{background:#3d7bff}
.btn-ghost{background:transparent;color:var(--muted);border:1px solid var(--border)}
.btn-ghost:hover{background:var(--card);color:var(--text)}
.btn-success{background:var(--green);color:#fff}
.btn-danger{background:var(--red);color:#fff}

.content{padding:28px 32px;flex:1}
.page{display:none}
.page.active{display:block}

/* ‚îÄ‚îÄ KPI CARDS ‚îÄ‚îÄ */
.kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:28px}
.kpi-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:20px;position:relative;overflow:hidden;transition:.3s}
.kpi-card:hover{border-color:var(--accent);transform:translateY(-2px)}
.kpi-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.kpi-card.blue::before{background:linear-gradient(90deg,var(--accent),var(--accent2))}
.kpi-card.green::before{background:linear-gradient(90deg,#22c55e,#16a34a)}
.kpi-card.orange::before{background:linear-gradient(90deg,#f97316,#ea580c)}
.kpi-card.pink::before{background:linear-gradient(90deg,#e879f9,#a21caf)}
.kpi-label{font-size:11px;color:var(--muted);font-family:var(--mono);letter-spacing:1px;margin-bottom:10px}
.kpi-value{font-size:28px;font-weight:800;margin-bottom:6px;letter-spacing:-1px}
.kpi-change{font-size:12px;font-family:var(--mono)}
.kpi-change.up{color:var(--green)}
.kpi-change.down{color:var(--red)}
.kpi-icon{position:absolute;top:16px;right:16px;font-size:24px;opacity:.3}

/* ‚îÄ‚îÄ CHART GRID ‚îÄ‚îÄ */
.chart-grid{display:grid;grid-template-columns:2fr 1fr;gap:16px;margin-bottom:16px}
.chart-grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:16px}
.chart-grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}
.chart-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:20px}
.chart-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.chart-title{font-size:14px;font-weight:700}
.chart-sub{font-size:11px;color:var(--muted);font-family:var(--mono);margin-top:2px}
.chart-badge{padding:4px 10px;border-radius:20px;font-size:11px;font-family:var(--mono);font-weight:500}
.badge-blue{background:rgba(79,141,255,.15);color:var(--accent)}
.badge-green{background:rgba(34,197,94,.15);color:var(--green)}
.badge-orange{background:rgba(249,115,22,.15);color:#f97316}
canvas{max-width:100%;display:block}

/* ‚îÄ‚îÄ TABLES ‚îÄ‚îÄ */
.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:13px}
thead th{background:var(--table-head);color:var(--muted);font-size:10px;font-family:var(--mono);letter-spacing:1.5px;padding:12px 14px;text-align:left;border-bottom:1px solid var(--border)}
tbody tr{border-bottom:1px solid var(--table-row);transition:.2s}
tbody tr:hover{background:var(--table-hover)}
tbody td{padding:12px 14px;font-size:13px}
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:20px;font-size:11px;font-family:var(--mono);font-weight:500}
.badge-success{background:rgba(34,197,94,.15);color:var(--green)}
.badge-warning{background:rgba(255,209,102,.15);color:var(--accent4)}
.badge-error{background:rgba(239,68,68,.15);color:var(--red)}
.badge-info{background:rgba(79,141,255,.15);color:var(--accent)}

/* ‚îÄ‚îÄ FORMS ‚îÄ‚îÄ */
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.form-group{display:flex;flex-direction:column;gap:6px}
.form-group.full{grid-column:1/-1}
label{font-size:12px;font-family:var(--mono);color:var(--muted);letter-spacing:.5px}
input,select,textarea{background:var(--input-bg);border:1px solid var(--border);border-radius:9px;padding:10px 14px;color:var(--text);font-family:var(--font);font-size:14px;outline:none;transition:.2s;width:100%}
input:focus,select:focus,textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(79,141,255,.12)}
select option{background:var(--card)}
.form-actions{display:flex;gap:10px;margin-top:20px}

/* ‚îÄ‚îÄ ALERTS ‚îÄ‚îÄ */
.alert{padding:12px 16px;border-radius:9px;font-size:13px;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.alert-success{background:rgba(34,197,94,.12);border:1px solid rgba(34,197,94,.3);color:var(--green)}
.alert-error{background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.3);color:var(--red)}
.alert-info{background:rgba(79,141,255,.12);border:1px solid rgba(79,141,255,.3);color:var(--accent)}
.hidden{display:none!important}

/* ‚îÄ‚îÄ REGION MAP FAKE ‚îÄ‚îÄ */
.region-list{display:flex;flex-direction:column;gap:8px}
.region-row{display:flex;align-items:center;gap:10px}
.region-name{font-size:13px;width:90px;flex-shrink:0}
.region-bar-wrap{flex:1;height:6px;background:var(--border);border-radius:3px;overflow:hidden}
.region-bar{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.region-val{font-size:12px;font-family:var(--mono);color:var(--muted);width:70px;text-align:right}

/* ‚îÄ‚îÄ UPLOAD ZONE ‚îÄ‚îÄ */
.upload-zone{border:2px dashed var(--border);border-radius:var(--radius);padding:40px;text-align:center;cursor:pointer;transition:.3s}
.upload-zone:hover{border-color:var(--accent);background:rgba(79,141,255,.04)}
.upload-icon{font-size:40px;margin-bottom:12px}
.upload-title{font-size:15px;font-weight:600;margin-bottom:6px}
.upload-sub{font-size:12px;color:var(--muted);font-family:var(--mono)}

/* ‚îÄ‚îÄ FORECAST ‚îÄ‚îÄ */
.forecast-stat{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;text-align:center}
.forecast-val{font-size:26px;font-weight:800;color:var(--accent2);letter-spacing:-1px}
.forecast-label{font-size:11px;color:var(--muted);font-family:var(--mono);margin-top:4px}
.forecast-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px}

/* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:var(--surface)}
::-webkit-scrollbar-thumb{background:var(--scrollbar);border-radius:3px}

/* ‚îÄ‚îÄ PRODUCT RANK ‚îÄ‚îÄ */
.product-item{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid rgba(30,35,64,.5)}
.product-rank{width:22px;height:22px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;font-family:var(--mono)}
.rank-1{background:rgba(255,209,102,.2);color:var(--accent4)}
.rank-2{background:rgba(79,141,255,.15);color:var(--accent)}
.rank-3{background:rgba(0,229,195,.15);color:var(--accent2)}
.rank-n{background:rgba(99,107,154,.12);color:var(--muted)}
.product-name{flex:1;font-size:13px}
.product-sales{font-size:13px;font-family:var(--mono);color:var(--accent2)}

/* ANIMATION */
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.page.active .kpi-card,.page.active .chart-card{animation:fadeUp .4s ease both}
.page.active .kpi-card:nth-child(1){animation-delay:.05s}
.page.active .kpi-card:nth-child(2){animation-delay:.1s}
.page.active .kpi-card:nth-child(3){animation-delay:.15s}
.page.active .kpi-card:nth-child(4){animation-delay:.2s}

.pulse{animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:200;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.modal{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:28px;width:500px;max-width:90vw;max-height:90vh;overflow-y:auto}
.modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
.modal-title{font-size:16px;font-weight:700}
.modal-close{background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer}

/* Live indicator */
.live-dot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:pulse 1.5s infinite}
.live-badge{display:flex;align-items:center;gap:5px;font-size:11px;font-family:var(--mono);color:var(--green)}

/* ‚îÄ‚îÄ THEME TOGGLE BUTTON ‚îÄ‚îÄ */
.theme-toggle{display:flex;align-items:center;background:var(--card);border:1px solid var(--border);border-radius:30px;padding:3px;gap:2px;cursor:pointer;position:relative}
.theme-btn{display:flex;align-items:center;gap:5px;padding:5px 12px;border-radius:24px;font-size:11px;font-weight:600;font-family:var(--mono);cursor:pointer;border:none;background:transparent;color:var(--muted);transition:.25s;white-space:nowrap}
.theme-btn.active{background:var(--accent);color:#fff;box-shadow:0 2px 8px rgba(79,141,255,.4)}
[data-theme="light"] .theme-btn.active{box-shadow:0 2px 8px rgba(79,141,255,.25)}

/* ‚îÄ‚îÄ SETTINGS PANEL (slide-in) ‚îÄ‚îÄ */
.settings-overlay{position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:opacity .3s}
.settings-overlay.open{opacity:1;pointer-events:all}
.settings-panel{position:fixed;top:0;right:-400px;width:360px;height:100vh;background:var(--surface);border-left:1px solid var(--border);z-index:301;display:flex;flex-direction:column;transition:right .35s cubic-bezier(.4,0,.2,1);box-shadow:-8px 0 40px rgba(0,0,0,.3);overflow-y:auto}
.settings-panel.open{right:0}
.settings-head{padding:24px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.settings-head-title{font-size:16px;font-weight:800;display:flex;align-items:center;gap:8px}
.settings-close{background:none;border:1px solid var(--border);border-radius:8px;color:var(--muted);width:32px;height:32px;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:.2s}
.settings-close:hover{background:var(--card);color:var(--text)}
.settings-body{padding:20px;flex:1}
.settings-section{margin-bottom:28px}
.settings-section-title{font-size:10px;font-family:var(--mono);letter-spacing:2px;color:var(--muted);margin-bottom:12px;padding-bottom:6px;border-bottom:1px solid var(--border)}

/* theme cards */
.theme-cards{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:6px}
.theme-card{border:2px solid var(--border);border-radius:12px;overflow:hidden;cursor:pointer;transition:.2s;position:relative}
.theme-card:hover{border-color:var(--accent);transform:translateY(-2px)}
.theme-card.selected{border-color:var(--accent);box-shadow:0 0 0 3px rgba(79,141,255,.2)}
.theme-card.selected::after{content:'‚úì';position:absolute;top:6px;right:6px;background:var(--accent);color:#fff;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700}
.theme-preview{height:54px;display:flex;gap:3px;padding:6px}
.tp-sidebar{width:18px;border-radius:4px}
.tp-content{flex:1;display:flex;flex-direction:column;gap:3px}
.tp-bar{height:8px;border-radius:3px}
.tp-bar2{height:6px;border-radius:3px;width:70%}
.theme-card-label{font-size:11px;font-weight:600;font-family:var(--mono);padding:6px 8px;border-top:1px solid var(--border);text-align:center}

/* dark preview */
.tp-dark .theme-preview{background:#07080f}
.tp-dark .tp-sidebar{background:#0e1120}
.tp-dark .tp-bar{background:#1e2340}
.tp-dark .tp-bar2{background:#13162a}
.tp-dark .theme-card-label{background:#0e1120;color:#636b9a}

/* light preview */
.tp-light .theme-preview{background:#f0f2f8}
.tp-light .tp-sidebar{background:#fff}
.tp-light .tp-bar{background:#dde1f0}
.tp-light .tp-bar2{background:#e8eaf6}
.tp-light .theme-card-label{background:#fff;color:#7b82a8}

/* midnight preview */
.tp-midnight .theme-preview{background:#000}
.tp-midnight .tp-sidebar{background:#0a0a14}
.tp-midnight .tp-bar{background:#1a1a2e}
.tp-midnight .tp-bar2{background:#16213e}
.tp-midnight .theme-card-label{background:#0a0a14;color:#4a4a8a}

/* accent colour swatches */
.accent-swatches{display:flex;gap:8px;flex-wrap:wrap}
.accent-swatch{width:32px;height:32px;border-radius:8px;cursor:pointer;border:2px solid transparent;transition:.2s;position:relative}
.accent-swatch:hover{transform:scale(1.15)}
.accent-swatch.selected{border-color:#fff;box-shadow:0 0 0 3px rgba(255,255,255,.3)}
[data-theme="light"] .accent-swatch.selected{border-color:#333;box-shadow:0 0 0 3px rgba(0,0,0,.15)}

/* font size */
.font-slider-wrap{display:flex;align-items:center;gap:12px}
.font-slider{-webkit-appearance:none;flex:1;height:4px;border-radius:2px;background:var(--border);outline:none;cursor:pointer}
.font-slider::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:var(--accent);cursor:pointer;box-shadow:0 0 6px rgba(79,141,255,.5)}
.font-size-label{font-size:12px;font-family:var(--mono);color:var(--muted);width:36px;text-align:right}

/* layout toggle */
.layout-btns{display:flex;gap:8px}
.layout-btn{flex:1;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--card);cursor:pointer;text-align:center;font-size:11px;font-family:var(--mono);color:var(--muted);transition:.2s}
.layout-btn:hover{border-color:var(--accent);color:var(--accent)}
.layout-btn.active{background:rgba(79,141,255,.12);border-color:rgba(79,141,255,.3);color:var(--accent)}
.layout-btn .lb-icon{font-size:20px;margin-bottom:4px}

/* compact mode */
.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border)}
.toggle-row:last-child{border-bottom:none}
.toggle-label{font-size:13px;font-weight:500}
.toggle-sub{font-size:11px;color:var(--muted);font-family:var(--mono);margin-top:2px}
.toggle-switch{position:relative;width:40px;height:22px;flex-shrink:0}
.toggle-switch input{opacity:0;width:0;height:0}
.toggle-track{position:absolute;inset:0;background:var(--border);border-radius:11px;cursor:pointer;transition:.3s}
.toggle-track::before{content:'';position:absolute;width:16px;height:16px;border-radius:50%;background:#fff;top:3px;left:3px;transition:.3s}
.toggle-switch input:checked+.toggle-track{background:var(--accent)}
.toggle-switch input:checked+.toggle-track::before{transform:translateX(18px)}

/* reset btn */
.settings-reset{width:100%;padding:10px;border-radius:10px;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);color:var(--red);font-family:var(--mono);font-size:12px;cursor:pointer;transition:.2s;margin-top:8px}
.settings-reset:hover{background:rgba(239,68,68,.2)}

/* compact mode adjustments */
body.compact .content{padding:16px 20px}
body.compact .kpi-grid{gap:10px;margin-bottom:16px}
body.compact .kpi-card{padding:14px}
body.compact .kpi-value{font-size:22px}
body.compact .chart-card{padding:14px}
body.compact .chart-grid,.body.compact .chart-grid-2,.body.compact .chart-grid-3{gap:10px;margin-bottom:10px}
body.compact .topbar{padding:14px 24px}

/* light mode sidebar extra polish */
[data-theme="light"] .sidebar{box-shadow:2px 0 20px rgba(100,110,180,.08)}
[data-theme="light"] .topbar{box-shadow:0 2px 12px rgba(100,110,180,.08)}
[data-theme="light"] .chart-card{box-shadow:0 2px 12px rgba(100,110,180,.06)}
[data-theme="light"] .kpi-card{box-shadow:0 2px 12px rgba(100,110,180,.06)}
[data-theme="light"] tbody tr:hover{background:rgba(79,141,255,.04)}

/* midnight theme */
[data-theme="midnight"]{
  --bg:#000000;
  --surface:#0a0a14;
  --card:#0f0f1e;
  --border:#1a1a2e;
  --text:#c8cadf;
  --muted:#4a4a8a;
  --shadow:0 4px 24px rgba(0,0,0,.8);
  --chart-grid:rgba(26,26,46,.9);
  --chart-text:#4a4a8a;
  --table-hover:rgba(79,141,255,.03);
  --table-head:rgba(79,141,255,.06);
  --table-row:rgba(26,26,46,.8);
  --input-bg:#0a0a14;
  --scrollbar:#1a1a2e;
}
</style>
</head>
<body>

<!-- SIDEBAR -->
<nav class="sidebar">
  <div class="logo">
    <div class="logo-mark">
      <div class="logo-icon">üìä</div>
      <div>
        <div class="logo-text">SalesIQ</div>
        <div class="logo-sub">ANALYTICS v2.0</div>
      </div>
    </div>
  </div>
  <div class="nav">
    <div class="nav-section">MAIN</div>
    <div class="nav-item active" onclick="showPage('dashboard',this)"><span class="nav-icon">‚ö°</span> Dashboard</div>
    <div class="nav-item" onclick="showPage('revenue',this)"><span class="nav-icon">üìà</span> Revenue</div>
    <div class="nav-item" onclick="showPage('products',this)"><span class="nav-icon">üì¶</span> Products</div>
    <div class="nav-section">INSIGHTS</div>
    <div class="nav-item" onclick="showPage('customers',this)"><span class="nav-icon">üë•</span> Customers</div>
    <div class="nav-item" onclick="showPage('regional',this)"><span class="nav-icon">üó∫Ô∏è</span> Regional</div>
    <div class="nav-item" onclick="showPage('forecast',this)"><span class="nav-icon">üîÆ</span> Forecast</div>
    <div class="nav-section">DATA</div>
    <div class="nav-item" onclick="showPage('insert',this)"><span class="nav-icon">‚ûï</span> Insert Data</div>
    <div class="nav-item" onclick="showPage('records',this)"><span class="nav-icon">üóÑÔ∏è</span> All Records</div>
    <div class="nav-item" onclick="showPage('reports',this)"><span class="nav-icon">üìã</span> Reports</div>
  </div>
  <div class="sidebar-footer">
    <div class="user-chip">
      <div class="avatar">AD</div>
      <div>
        <div class="user-info">Admin</div>
        <div class="user-role">MANAGER</div>
      </div>
    </div>
  </div>
</nav>

<!-- MAIN -->
<div class="main">
  <div class="topbar">
    <div>
      <div class="page-title" id="pageTitle">Sales Dashboard</div>
      <div class="page-sub" id="pageSub">Real-time performance overview</div>
    </div>
    <div class="topbar-right">
      <div class="live-badge"><div class="live-dot"></div>LIVE</div>
      <div class="date-chip" id="datechip"></div>
      <!-- Theme Quick Toggle -->
      <div class="theme-toggle" title="Toggle theme">
        <button class="theme-btn active" id="btnDark" onclick="setTheme('dark')">üåô Dark</button>
        <button class="theme-btn" id="btnLight" onclick="setTheme('light')">‚òÄÔ∏è Light</button>
      </div>
      <!-- Settings -->
      <button class="btn btn-ghost" onclick="openSettings()" title="Settings" style="padding:8px 12px;font-size:16px">‚öôÔ∏è</button>
      <button class="btn btn-primary" onclick="showPage('insert',document.querySelectorAll('.nav-item')[6])">+ Add Sale</button>
    </div>
  </div>

  <div class="content">

    <!-- ‚îÄ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ‚îÄ -->
    <div class="page active" id="page-dashboard">
      <div class="kpi-grid">
        <div class="kpi-card blue">
          <div class="kpi-label">TOTAL REVENUE</div>
          <div class="kpi-value" id="kpi-rev">‚Çπ0</div>
          <div class="kpi-change up" id="kpi-rev-ch">‚Üë +0%</div>
          <div class="kpi-icon">üí∞</div>
        </div>
        <div class="kpi-card green">
          <div class="kpi-label">TOTAL ORDERS</div>
          <div class="kpi-value" id="kpi-ord">0</div>
          <div class="kpi-change up" id="kpi-ord-ch">‚Üë +0%</div>
          <div class="kpi-icon">üõí</div>
        </div>
        <div class="kpi-card orange">
          <div class="kpi-label">AVG ORDER VALUE</div>
          <div class="kpi-value" id="kpi-aov">‚Çπ0</div>
          <div class="kpi-change up" id="kpi-aov-ch">‚Äî stable</div>
          <div class="kpi-icon">üìä</div>
        </div>
        <div class="kpi-card pink">
          <div class="kpi-label">PROFIT MARGIN</div>
          <div class="kpi-value" id="kpi-margin">0%</div>
          <div class="kpi-change up" id="kpi-margin-ch">‚Üë healthy</div>
          <div class="kpi-icon">üìâ</div>
        </div>
      </div>

      <div class="chart-grid">
        <div class="chart-card">
          <div class="chart-header">
            <div>
              <div class="chart-title">Revenue & Orders ‚Äî Monthly</div>
              <div class="chart-sub">Combined bar + line chart</div>
            </div>
            <span class="chart-badge badge-blue">2025</span>
          </div>
          <canvas id="dashMainChart" height="200"></canvas>
        </div>
        <div class="chart-card">
          <div class="chart-header">
            <div>
              <div class="chart-title">Category Share</div>
              <div class="chart-sub">Revenue by product type</div>
            </div>
            <span class="chart-badge badge-green">LIVE</span>
          </div>
          <canvas id="dashPieChart" height="200"></canvas>
        </div>
      </div>

      <div class="chart-grid-3">
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">Top Products</div><div class="chart-sub">By revenue</div></div></div>
          <div id="topProductsList"></div>
        </div>
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">Regional Sales</div><div class="chart-sub">State-wise breakdown</div></div></div>
          <div class="region-list" id="regionList"></div>
        </div>
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">Customer Segments</div><div class="chart-sub">RFM segmentation</div></div></div>
          <canvas id="dashSegChart" height="180"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div><div class="chart-title">Recent Transactions</div><div class="chart-sub">Last 10 entries</div></div>
          <button class="btn btn-ghost" onclick="showPage('records',document.querySelectorAll('.nav-item')[7])">View All ‚Üí</button>
        </div>
        <div class="table-wrap" id="recentTxTable"></div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ REVENUE ‚îÄ‚îÄ‚îÄ -->
    <div class="page" id="page-revenue">
      <div class="chart-card" style="margin-bottom:16px">
        <div class="chart-header">
          <div><div class="chart-title">Monthly Revenue Trend</div><div class="chart-sub">Year over year comparison</div></div>
          <div style="display:flex;gap:8px">
            <span class="chart-badge badge-blue">2024</span>
            <span class="chart-badge badge-green">2025</span>
          </div>
        </div>
        <canvas id="revLineChart" height="130"></canvas>
      </div>
      <div class="chart-grid-2">
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">Quarterly Revenue</div><div class="chart-sub">Q1‚ÄìQ4 breakdown</div></div></div>
          <canvas id="revQtrChart" height="200"></canvas>
        </div>
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">Revenue vs Target</div><div class="chart-sub">Monthly achievement</div></div></div>
          <canvas id="revTargetChart" height="200"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Monthly Revenue Table</div></div></div>
        <div class="table-wrap" id="revTable"></div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ PRODUCTS ‚îÄ‚îÄ‚îÄ -->
    <div class="page" id="page-products">
      <div class="chart-grid">
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">Product Performance</div><div class="chart-sub">Revenue by product</div></div></div>
          <canvas id="prodBarChart" height="220"></canvas>
        </div>
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">Category Distribution</div></div></div>
          <canvas id="prodPieChart" height="220"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">All Products ‚Äî Detailed</div></div><button class="btn btn-ghost" onclick="exportTableCSV('prodTable')">‚¨á Export CSV</button></div>
        <div class="table-wrap" id="prodTable"></div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ CUSTOMERS ‚îÄ‚îÄ‚îÄ -->
    <div class="page" id="page-customers">
      <div class="kpi-grid">
        <div class="kpi-card blue"><div class="kpi-label">TOTAL CUSTOMERS</div><div class="kpi-value" id="cust-total">0</div><div class="kpi-icon">üë•</div></div>
        <div class="kpi-card green"><div class="kpi-label">PREMIUM</div><div class="kpi-value" id="cust-premium">0</div><div class="kpi-icon">‚≠ê</div></div>
        <div class="kpi-card orange"><div class="kpi-label">REGULAR</div><div class="kpi-value" id="cust-regular">0</div><div class="kpi-icon">üîµ</div></div>
        <div class="kpi-card pink"><div class="kpi-label">AT-RISK</div><div class="kpi-value" id="cust-atrisk">0</div><div class="kpi-icon">‚ö†Ô∏è</div></div>
      </div>
      <div class="chart-grid">
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">Customer Segments ‚Äî Donut</div></div></div>
          <canvas id="custSegChart" height="250"></canvas>
        </div>
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">Purchase Frequency</div><div class="chart-sub">Orders per customer</div></div></div>
          <canvas id="custFreqChart" height="250"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Customer List</div></div></div>
        <div class="table-wrap" id="custTable"></div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ REGIONAL ‚îÄ‚îÄ‚îÄ -->
    <div class="page" id="page-regional">
      <div class="chart-grid">
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">State-wise Revenue</div><div class="chart-sub">Horizontal bar chart</div></div></div>
          <canvas id="regBarChart" height="300"></canvas>
        </div>
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">Region Share</div></div></div>
          <canvas id="regPieChart" height="300"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Regional Performance Table</div></div></div>
        <div class="table-wrap" id="regTable"></div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ FORECAST ‚îÄ‚îÄ‚îÄ -->
    <div class="page" id="page-forecast">
      <div class="forecast-grid" id="forecastKPIs"></div>
      <div class="chart-card" style="margin-bottom:16px">
        <div class="chart-header"><div><div class="chart-title">Sales Forecast ‚Äî Next 3 Months</div><div class="chart-sub">Linear regression trend + confidence band</div></div><span class="chart-badge badge-green">91.3% Accuracy</span></div>
        <canvas id="forecastChart" height="200"></canvas>
      </div>
      <div class="chart-grid-2">
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">Forecast by Category</div></div></div>
          <canvas id="forecastCatChart" height="220"></canvas>
        </div>
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">Forecast Table</div></div></div>
          <div class="table-wrap" id="forecastTable"></div>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ INSERT DATA ‚îÄ‚îÄ‚îÄ -->
    <div class="page" id="page-insert">
      <div id="insertAlert" class="alert alert-success hidden"></div>
      <div class="chart-grid-2">
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">‚ûï Add New Sale Record</div><div class="chart-sub">Manual entry form</div></div></div>
          <div class="form-grid">
            <div class="form-group">
              <label>DATE *</label>
              <input type="date" id="f-date"/>
            </div>
            <div class="form-group">
              <label>ORDER ID *</label>
              <input type="text" id="f-orderid" placeholder="e.g. ORD-1050"/>
            </div>
            <div class="form-group">
              <label>PRODUCT *</label>
              <input type="text" id="f-product" placeholder="e.g. Laptop Pro X"/>
            </div>
            <div class="form-group">
              <label>CATEGORY *</label>
              <select id="f-category">
                <option value="">‚Äî Select ‚Äî</option>
                <option>Electronics</option>
                <option>Clothing</option>
                <option>Furniture</option>
                <option>Grocery</option>
                <option>Sports</option>
                <option>Books</option>
                <option>Beauty</option>
                <option>Automotive</option>
              </select>
            </div>
            <div class="form-group">
              <label>QUANTITY *</label>
              <input type="number" id="f-qty" placeholder="1" min="1"/>
            </div>
            <div class="form-group">
              <label>UNIT PRICE (‚Çπ) *</label>
              <input type="number" id="f-price" placeholder="0.00" min="0" step="0.01"/>
            </div>
            <div class="form-group">
              <label>CUSTOMER NAME</label>
              <input type="text" id="f-customer" placeholder="e.g. Rahul Sharma"/>
            </div>
            <div class="form-group">
              <label>REGION *</label>
              <select id="f-region">
                <option value="">‚Äî Select ‚Äî</option>
                <option>North</option>
                <option>South</option>
                <option>East</option>
                <option>West</option>
                <option>Central</option>
              </select>
            </div>
            <div class="form-group">
              <label>STATE</label>
              <input type="text" id="f-state" placeholder="e.g. Uttarakhand"/>
            </div>
            <div class="form-group">
              <label>PAYMENT METHOD</label>
              <select id="f-payment">
                <option>UPI</option>
                <option>Credit Card</option>
                <option>Debit Card</option>
                <option>Cash</option>
                <option>Net Banking</option>
              </select>
            </div>
            <div class="form-group">
              <label>STATUS</label>
              <select id="f-status">
                <option>Completed</option>
                <option>Pending</option>
                <option>Returned</option>
              </select>
            </div>
            <div class="form-group">
              <label>DISCOUNT (%)</label>
              <input type="number" id="f-discount" placeholder="0" min="0" max="100"/>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" onclick="insertRecord()">üíæ Save Record</button>
            <button class="btn btn-ghost" onclick="clearForm()">‚úï Clear</button>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-header"><div><div class="chart-title">üìÅ CSV Bulk Upload</div><div class="chart-sub">Upload multiple records at once</div></div></div>
          <div class="upload-zone" onclick="document.getElementById('csvFile').click()" id="uploadZone">
            <div class="upload-icon">üìÇ</div>
            <div class="upload-title">Drop CSV file here</div>
            <div class="upload-sub">or click to browse</div>
            <input type="file" id="csvFile" accept=".csv" style="display:none" onchange="handleCSV(event)"/>
          </div>
          <div style="margin-top:16px;padding:14px;background:var(--surface);border-radius:10px;font-size:12px;font-family:var(--mono);color:var(--muted);line-height:1.8">
            EXPECTED COLUMNS:<br/>
            date, orderid, product, category,<br/>
            qty, price, customer, region,<br/>
            state, payment, status, discount
          </div>
          <div id="csvAlert" class="alert hidden" style="margin-top:12px"></div>
          <button class="btn btn-success" style="margin-top:12px;width:100%" onclick="downloadSampleCSV()">‚¨á Download Sample CSV</button>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Preview ‚Äî Last 5 Records Added</div></div></div>
        <div class="table-wrap" id="insertPreviewTable"></div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ RECORDS ‚îÄ‚îÄ‚îÄ -->
    <div class="page" id="page-records">
      <div class="chart-card">
        <div class="chart-header">
          <div><div class="chart-title">All Sales Records</div><div class="chart-sub" id="recordCount">0 entries</div></div>
          <div style="display:flex;gap:8px">
            <input type="text" id="searchInput" placeholder="üîç  Search..." style="width:200px;padding:7px 12px;font-size:13px" oninput="filterRecords()"/>
            <select id="filterCat" style="width:140px" onchange="filterRecords()">
              <option value="">All Categories</option>
              <option>Electronics</option><option>Clothing</option><option>Furniture</option>
              <option>Grocery</option><option>Sports</option><option>Books</option>
              <option>Beauty</option><option>Automotive</option>
            </select>
            <button class="btn btn-ghost" onclick="exportTableCSV('recordsTableEl')">‚¨á Export CSV</button>
          </div>
        </div>
        <div class="table-wrap" id="recordsTableEl"></div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ REPORTS ‚îÄ‚îÄ‚îÄ -->
    <div class="page" id="page-reports">

      <!-- Top action cards -->
      <div class="chart-grid-3" style="margin-bottom:20px">
        <div class="chart-card" style="text-align:center;cursor:pointer" onclick="printReport()">
          <div style="font-size:36px;margin-bottom:12px">üìä</div>
          <div class="chart-title">Summary Report</div>
          <div class="chart-sub" style="margin-top:6px">Print / Save as PDF</div>
          <button class="btn btn-primary" style="margin-top:16px;width:100%">üñ® Generate PDF</button>
        </div>
        <div class="chart-card" style="text-align:center;cursor:pointer" onclick="exportTableCSV('recordsTableEl');showPage('records',document.querySelectorAll('.nav-item')[7])">
          <div style="font-size:36px;margin-bottom:12px">üì•</div>
          <div class="chart-title">Data Export</div>
          <div class="chart-sub" style="margin-top:6px">All records as CSV</div>
          <button class="btn btn-ghost" style="margin-top:16px;width:100%">‚¨á Export CSV</button>
        </div>
        <div class="chart-card" style="text-align:center">
          <div style="font-size:36px;margin-bottom:12px">üìã</div>
          <div class="chart-title">Quick Stats</div>
          <div class="chart-sub" style="margin-top:6px">Live summary snapshot</div>
          <div id="quickStatsSnap" style="margin-top:14px;text-align:left;font-size:12px;font-family:var(--mono);line-height:2;color:var(--muted)"></div>
        </div>
      </div>

      <!-- Email Compose Card -->
      <div class="chart-card" style="margin-bottom:16px">
        <div class="chart-header">
          <div>
            <div class="chart-title">üìß Email Report</div>
            <div class="chart-sub">Compose and send sales report via your mail app</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <span class="chart-badge badge-green" id="emailMethodBadge">‚úì mailto: ready</span>
          </div>
        </div>

        <!-- alert zone -->
        <div id="emailAlert" class="alert hidden" style="margin-bottom:16px"></div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">
          <!-- TO -->
          <div class="form-group">
            <label>TO (RECIPIENT) *</label>
            <input type="email" id="emailTo" placeholder="manager@company.com"/>
          </div>
          <!-- CC -->
          <div class="form-group">
            <label>CC (OPTIONAL)</label>
            <input type="email" id="emailCc" placeholder="team@company.com"/>
          </div>
          <!-- SUBJECT -->
          <div class="form-group" style="grid-column:1/-1">
            <label>SUBJECT</label>
            <input type="text" id="emailSubject" placeholder="Sales Analytics Report ‚Äî SalesIQ"/>
          </div>
        </div>

        <!-- Report type checkboxes -->
        <div style="margin-bottom:14px">
          <label style="margin-bottom:8px;display:block">INCLUDE IN REPORT</label>
          <div style="display:flex;gap:16px;flex-wrap:wrap">
            <label style="display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer;font-family:var(--font);color:var(--text)">
              <input type="checkbox" id="inclKPI" checked style="width:auto;accent-color:var(--accent)"> KPI Summary
            </label>
            <label style="display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer;font-family:var(--font);color:var(--text)">
              <input type="checkbox" id="inclRevenue" checked style="width:auto;accent-color:var(--accent)"> Revenue Data
            </label>
            <label style="display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer;font-family:var(--font);color:var(--text)">
              <input type="checkbox" id="inclProducts" checked style="width:auto;accent-color:var(--accent)"> Top Products
            </label>
            <label style="display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer;font-family:var(--font);color:var(--text)">
              <input type="checkbox" id="inclRegional" checked style="width:auto;accent-color:var(--accent)"> Regional Breakdown
            </label>
            <label style="display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer;font-family:var(--font);color:var(--text)">
              <input type="checkbox" id="inclForecast" checked style="width:auto;accent-color:var(--accent)"> Forecast
            </label>
          </div>
        </div>

        <!-- Body preview -->
        <div class="form-group" style="margin-bottom:16px">
          <label style="display:flex;justify-content:space-between;align-items:center">
            EMAIL BODY PREVIEW
            <button class="btn btn-ghost" style="padding:3px 10px;font-size:11px" onclick="refreshEmailPreview()">‚Üª Refresh</button>
          </label>
          <textarea id="emailBody" rows="12" style="font-family:var(--mono);font-size:12px;line-height:1.7;resize:vertical"></textarea>
        </div>

        <!-- Actions -->
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn btn-success" onclick="sendEmailMailto()" style="flex:1;min-width:160px">
            ‚úâ Open in Mail App
          </button>
          <button class="btn btn-primary" onclick="sendEmailGmail()" style="flex:1;min-width:160px">
            üì® Open in Gmail
          </button>
          <button class="btn btn-ghost" onclick="copyEmailBody()" style="flex:1;min-width:140px">
            üìã Copy Body
          </button>
          <button class="btn btn-ghost" onclick="downloadReportTxt()" style="flex:1;min-width:140px">
            ‚¨á Save as .txt
          </button>
        </div>

        <!-- How it works note -->
        <div style="margin-top:16px;padding:12px 14px;background:var(--surface);border-radius:10px;border:1px solid var(--border);font-size:12px;font-family:var(--mono);color:var(--muted);line-height:1.8">
          ‚ÑπÔ∏è  <b style="color:var(--text)">How it works:</b> "Open in Mail App" launches your default Mac mail client (Mail, Outlook, Spark etc.) with the report pre-filled. "Open in Gmail" opens Gmail in a new browser tab. Both work 100% offline ‚Äî no server needed.
        </div>
      </div>

      <!-- Report Summary Preview -->
      <div class="chart-card">
        <div class="chart-header">
          <div><div class="chart-title">Report Summary Preview</div><div class="chart-sub">Full formatted report</div></div>
          <button class="btn btn-ghost" onclick="printReport()">üñ® Print</button>
        </div>
        <div id="reportSummary" style="font-size:13px;line-height:2;color:var(--muted);font-family:var(--mono)"></div>
      </div>
    </div>

  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DATA STORE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let salesData = [
  {date:'2025-01-05',orderid:'ORD-1001',product:'Laptop Pro X',category:'Electronics',qty:2,price:45000,customer:'Rahul Sharma',region:'North',state:'Uttarakhand',payment:'Credit Card',status:'Completed',discount:5},
  {date:'2025-01-12',orderid:'ORD-1002',product:'Cotton Kurta Set',category:'Clothing',qty:3,price:1200,customer:'Priya Patel',region:'West',state:'Gujarat',payment:'UPI',status:'Completed',discount:10},
  {date:'2025-01-18',orderid:'ORD-1003',product:'Office Chair',category:'Furniture',qty:1,price:12000,customer:'Amit Kumar',region:'South',state:'Karnataka',payment:'Net Banking',status:'Completed',discount:0},
  {date:'2025-01-25',orderid:'ORD-1004',product:'Protein Powder',category:'Sports',qty:2,price:2500,customer:'Sonia Gupta',region:'East',state:'West Bengal',payment:'Debit Card',status:'Completed',discount:0},
  {date:'2025-02-03',orderid:'ORD-1005',product:'Wireless Earbuds',category:'Electronics',qty:1,price:8500,customer:'Vikram Singh',region:'Central',state:'Madhya Pradesh',payment:'UPI',status:'Completed',discount:15},
  {date:'2025-02-10',orderid:'ORD-1006',product:'Basmati Rice 5kg',category:'Grocery',qty:5,price:650,customer:'Meena Reddy',region:'South',state:'Andhra Pradesh',payment:'Cash',status:'Completed',discount:0},
  {date:'2025-02-14',orderid:'ORD-1007',product:'Yoga Mat',category:'Sports',qty:2,price:1800,customer:'Deepak Verma',region:'North',state:'Delhi',payment:'UPI',status:'Completed',discount:5},
  {date:'2025-02-20',orderid:'ORD-1008',product:'Smart Watch',category:'Electronics',qty:1,price:15000,customer:'Kavita Joshi',region:'West',state:'Maharashtra',payment:'Credit Card',status:'Pending',discount:10},
  {date:'2025-03-02',orderid:'ORD-1009',product:'Dining Table',category:'Furniture',qty:1,price:28000,customer:'Suresh Nair',region:'South',state:'Kerala',payment:'Net Banking',status:'Completed',discount:8},
  {date:'2025-03-08',orderid:'ORD-1010',product:'Python Programming Book',category:'Books',qty:3,price:750,customer:'Asha Mishra',region:'East',state:'Bihar',payment:'Cash',status:'Completed',discount:0},
  {date:'2025-03-15',orderid:'ORD-1011',product:'Face Serum Kit',category:'Beauty',qty:2,price:2200,customer:'Riya Malhotra',region:'North',state:'Punjab',payment:'UPI',status:'Completed',discount:12},
  {date:'2025-03-22',orderid:'ORD-1012',product:'Car Seat Cover',category:'Automotive',qty:1,price:3500,customer:'Manoj Yadav',region:'Central',state:'Uttar Pradesh',payment:'Credit Card',status:'Returned',discount:0},
  {date:'2025-04-05',orderid:'ORD-1013',product:'LED Monitor 27"',category:'Electronics',qty:2,price:18000,customer:'Sunita Banerjee',region:'East',state:'West Bengal',payment:'Net Banking',status:'Completed',discount:7},
  {date:'2025-04-11',orderid:'ORD-1014',product:'Formal Shirt Pack',category:'Clothing',qty:4,price:1500,customer:'Arun Pillai',region:'South',state:'Tamil Nadu',payment:'UPI',status:'Completed',discount:20},
  {date:'2025-04-18',orderid:'ORD-1015',product:'Gaming Keyboard',category:'Electronics',qty:1,price:5500,customer:'Nikhil Chauhan',region:'North',state:'Haryana',payment:'Credit Card',status:'Completed',discount:0},
  {date:'2025-04-25',orderid:'ORD-1016',product:'Sofa 3-Seater',category:'Furniture',qty:1,price:35000,customer:'Geeta Saxena',region:'Central',state:'Rajasthan',payment:'Net Banking',status:'Completed',discount:5},
  {date:'2025-05-04',orderid:'ORD-1017',product:'Whey Protein',category:'Sports',qty:3,price:3200,customer:'Kiran Shah',region:'West',state:'Gujarat',payment:'UPI',status:'Completed',discount:10},
  {date:'2025-05-12',orderid:'ORD-1018',product:'Wireless Mouse',category:'Electronics',qty:5,price:1200,customer:'Preeti Rathore',region:'North',state:'Himachal Pradesh',payment:'Debit Card',status:'Completed',discount:0},
  {date:'2025-05-20',orderid:'ORD-1019',product:'Moisturizer SPF 50',category:'Beauty',qty:2,price:1800,customer:'Ananya Das',region:'East',state:'Odisha',payment:'UPI',status:'Completed',discount:5},
  {date:'2025-06-01',orderid:'ORD-1020',product:'Trekking Shoes',category:'Sports',qty:1,price:4500,customer:'Rohit Mehta',region:'North',state:'Uttarakhand',payment:'Credit Card',status:'Completed',discount:15},
  {date:'2025-06-08',orderid:'ORD-1021',product:'Tablet 10"',category:'Electronics',qty:2,price:22000,customer:'Swati Kapoor',region:'West',state:'Maharashtra',payment:'Net Banking',status:'Completed',discount:8},
  {date:'2025-06-15',orderid:'ORD-1022',product:'Rice Cooker',category:'Grocery',qty:3,price:2100,customer:'Ajay Sinha',region:'Central',state:'Chhattisgarh',payment:'Cash',status:'Completed',discount:0},
  {date:'2025-06-22',orderid:'ORD-1023',product:'Lehenga Set',category:'Clothing',qty:1,price:8500,customer:'Divya Nair',region:'South',state:'Kerala',payment:'Credit Card',status:'Pending',discount:5},
  {date:'2025-06-28',orderid:'ORD-1024',product:'Bookshelf',category:'Furniture',qty:1,price:7500,customer:'Sanjay Trivedi',region:'East',state:'Jharkhand',payment:'UPI',status:'Completed',discount:0},
  {date:'2025-06-30',orderid:'ORD-1025',product:'Car Air Freshener',category:'Automotive',qty:6,price:350,customer:'Pallavi More',region:'West',state:'Goa',payment:'Cash',status:'Completed',discount:0},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const fmt = v => '‚Çπ'+v.toLocaleString('en-IN');
const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const CHART_DEFAULTS = {color:'rgba(79,141,255,.08)',grid:'rgba(30,35,64,.7)',text:'#636b9a'};

function getRevenue(d){
  const p = d.price*d.qty;
  return p - p*(d.discount||0)/100;
}

function updateDate(){
  document.getElementById('datechip').textContent = new Date().toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});
}

function chartDefaults(){
  const isDark = document.documentElement.getAttribute('data-theme') !== 'light';
  Chart.defaults.color = isDark ? '#636b9a' : '#7b82a8';
  Chart.defaults.borderColor = isDark ? 'rgba(30,35,64,.7)' : 'rgba(200,205,230,.6)';
  Chart.defaults.font.family = "'DM Mono', monospace";
  Chart.defaults.font.size = 11;
}

const COLORS = ['#4f8dff','#00e5c3','#ff6b6b','#ffd166','#e879f9','#22c55e','#f97316','#38bdf8'];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const pageTitles = {
  dashboard:['Sales Dashboard','Real-time performance overview'],
  revenue:['Revenue Analytics','Monthly & quarterly trends'],
  products:['Product Performance','Top sellers & category breakdown'],
  customers:['Customer Insights','Segmentation & behavior'],
  regional:['Regional Sales','Geographic performance'],
  forecast:['Sales Forecast','Next 90-day prediction'],
  insert:['Insert Data','Add new sales records'],
  records:['All Records','Complete transaction history'],
  reports:['Reports','Generate & export reports'],
};

function showPage(id, el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  if(el) el.classList.add('active');
  const [title,sub] = pageTitles[id]||[id,''];
  document.getElementById('pageTitle').textContent = title;
  document.getElementById('pageSub').textContent = sub;
  renderPage(id);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RENDER ROUTER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const rendered = {};
function renderPage(id){
  if(id==='dashboard') renderDashboard();
  else if(id==='revenue') renderRevenue();
  else if(id==='products') renderProducts();
  else if(id==='customers') renderCustomers();
  else if(id==='regional') renderRegional();
  else if(id==='forecast') renderForecast();
  else if(id==='insert') renderInsert();
  else if(id==='records') renderRecords();
  else if(id==='reports') renderReports();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let dashCharts = {};
function renderDashboard(){
  const rev = salesData.reduce((s,d)=>s+getRevenue(d),0);
  const orders = salesData.filter(d=>d.status!=='Returned').length;
  const aov = orders?rev/orders:0;
  const margin = 28.4;

  document.getElementById('kpi-rev').textContent = fmt(Math.round(rev));
  document.getElementById('kpi-ord').textContent = orders;
  document.getElementById('kpi-aov').textContent = fmt(Math.round(aov));
  document.getElementById('kpi-margin').textContent = margin+'%';

  // Monthly data
  const monthRev = Array(6).fill(0);
  const monthOrd = Array(6).fill(0);
  salesData.forEach(d=>{
    const m = new Date(d.date).getMonth();
    if(m<6){monthRev[m]+=getRevenue(d);monthOrd[m]++;}
  });

  // Main chart
  destroyChart('dashMainChart');
  dashCharts.main = new Chart(document.getElementById('dashMainChart'),{
    data:{
      labels:months.slice(0,6),
      datasets:[
        {type:'bar',label:'Revenue (‚Çπ)',data:monthRev,backgroundColor:COLORS.map(c=>c+'44'),borderColor:COLORS,borderWidth:2,borderRadius:6,yAxisID:'y'},
        {type:'line',label:'Orders',data:monthOrd,borderColor:'#00e5c3',backgroundColor:'rgba(0,229,195,.1)',tension:.4,pointRadius:4,fill:true,yAxisID:'y1'},
      ]
    },
    options:{responsive:true,plugins:{legend:{position:'top'}},scales:{
      y:{grid:{color:CHART_DEFAULTS.grid},ticks:{callback:v=>'‚Çπ'+v.toLocaleString('en-IN')}},
      y1:{position:'right',grid:{display:false}}
    }}
  });

  // Pie chart
  const cats = {};
  salesData.forEach(d=>{cats[d.category]=(cats[d.category]||0)+getRevenue(d);});
  destroyChart('dashPieChart');
  dashCharts.pie = new Chart(document.getElementById('dashPieChart'),{
    type:'doughnut',
    data:{labels:Object.keys(cats),datasets:[{data:Object.values(cats),backgroundColor:COLORS,borderWidth:0,hoverOffset:8}]},
    options:{responsive:true,plugins:{legend:{position:'bottom'}},cutout:'65%'}
  });

  // Segment chart
  destroyChart('dashSegChart');
  dashCharts.seg = new Chart(document.getElementById('dashSegChart'),{
    type:'doughnut',
    data:{labels:['Premium','Regular','New','At-Risk'],datasets:[{data:[8,12,5,3],backgroundColor:['#ffd166','#4f8dff','#00e5c3','#ff6b6b'],borderWidth:0}]},
    options:{responsive:true,plugins:{legend:{position:'bottom'}},cutout:'60%'}
  });

  // Top products
  const prods = {};
  salesData.forEach(d=>{prods[d.product]=(prods[d.product]||0)+getRevenue(d);});
  const sorted = Object.entries(prods).sort((a,b)=>b[1]-a[1]).slice(0,5);
  document.getElementById('topProductsList').innerHTML = sorted.map(([n,v],i)=>
    `<div class="product-item"><div class="product-rank ${i===0?'rank-1':i===1?'rank-2':i===2?'rank-3':'rank-n'}">${i+1}</div><div class="product-name">${n}</div><div class="product-sales">${fmt(Math.round(v))}</div></div>`
  ).join('');

  // Region list
  const regions = {};
  salesData.forEach(d=>{regions[d.region]=(regions[d.region]||0)+getRevenue(d);});
  const maxR = Math.max(...Object.values(regions));
  document.getElementById('regionList').innerHTML = Object.entries(regions).sort((a,b)=>b[1]-a[1]).map(([r,v])=>
    `<div class="region-row"><div class="region-name">${r}</div><div class="region-bar-wrap"><div class="region-bar" style="width:${(v/maxR*100).toFixed(1)}%"></div></div><div class="region-val">${fmt(Math.round(v))}</div></div>`
  ).join('');

  // Recent table
  document.getElementById('recentTxTable').innerHTML = makeTable(salesData.slice(-10).reverse());
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  REVENUE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let revCharts = {};
function renderRevenue(){
  const m25 = Array(6).fill(0);
  const m24 = [285000,320000,480000,410000,540000,610000];
  salesData.forEach(d=>{const m=new Date(d.date).getMonth();if(m<6)m25[m]+=getRevenue(d);});

  destroyChart('revLineChart');
  revCharts.line = new Chart(document.getElementById('revLineChart'),{
    type:'line',
    data:{labels:months.slice(0,6),datasets:[
      {label:'2024',data:m24,borderColor:'#636b9a',backgroundColor:'rgba(99,107,154,.05)',tension:.4,fill:true,pointRadius:4,borderDash:[5,5]},
      {label:'2025',data:m25,borderColor:'#4f8dff',backgroundColor:'rgba(79,141,255,.1)',tension:.4,fill:true,pointRadius:5},
    ]},
    options:{responsive:true,plugins:{legend:{position:'top'}},scales:{y:{grid:{color:CHART_DEFAULTS.grid},ticks:{callback:v=>'‚Çπ'+v.toLocaleString('en-IN')}}}}
  });

  destroyChart('revQtrChart');
  revCharts.qtr = new Chart(document.getElementById('revQtrChart'),{
    type:'bar',
    data:{labels:['Q1 (J-M)','Q2 (A-J)','Q3 (J-S)','Q4 (O-D)'],datasets:[
      {label:'2024',data:[m24[0]+m24[1]+m24[2],m24[3]+m24[4]+m24[5],980000,1150000],backgroundColor:'rgba(99,107,154,.3)',borderRadius:6},
      {label:'2025',data:[m25[0]+m25[1]+m25[2],m25[3]+m25[4]+m25[5],0,0],backgroundColor:'rgba(79,141,255,.6)',borderRadius:6},
    ]},
    options:{responsive:true,plugins:{legend:{position:'top'}},scales:{y:{grid:{color:CHART_DEFAULTS.grid},ticks:{callback:v=>'‚Çπ'+v.toLocaleString('en-IN')}}}}
  });

  const targets = [500000,550000,650000,600000,700000,850000];
  destroyChart('revTargetChart');
  revCharts.tgt = new Chart(document.getElementById('revTargetChart'),{
    type:'bar',
    data:{labels:months.slice(0,6),datasets:[
      {label:'Target',data:targets,backgroundColor:'rgba(255,209,102,.25)',borderColor:'#ffd166',borderWidth:2,borderRadius:6},
      {label:'Actual',data:m25,backgroundColor:'rgba(0,229,195,.4)',borderColor:'#00e5c3',borderWidth:2,borderRadius:6},
    ]},
    options:{responsive:true,plugins:{legend:{position:'top'}},scales:{y:{grid:{color:CHART_DEFAULTS.grid},ticks:{callback:v=>'‚Çπ'+v.toLocaleString('en-IN')}}}}
  });

  // Table
  const rows = months.slice(0,6).map((mo,i)=>{
    const act=Math.round(m25[i]),tgt=targets[i],diff=act-tgt,pct=(act/tgt*100).toFixed(1);
    const badge = pct>=100?'<span class="badge badge-success">‚úì Met</span>':'<span class="badge badge-warning">‚ö† Below</span>';
    return `<tr><td>${mo} 2025</td><td>${fmt(act)}</td><td>${fmt(tgt)}</td><td style="color:${diff>=0?'#22c55e':'#ef4444'}">${diff>=0?'+':''}${fmt(diff)}</td><td>${pct}%</td><td>${badge}</td></tr>`;
  });
  document.getElementById('revTable').innerHTML = `<table><thead><tr><th>MONTH</th><th>ACTUAL</th><th>TARGET</th><th>VARIANCE</th><th>ACHIEVEMENT</th><th>STATUS</th></tr></thead><tbody>${rows.join('')}</tbody></table>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PRODUCTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let prodCharts = {};
function renderProducts(){
  const prods = {};
  const cats = {};
  salesData.forEach(d=>{
    prods[d.product] = prods[d.product]||{rev:0,qty:0,category:d.category,returns:0,orders:0};
    prods[d.product].rev += getRevenue(d);
    prods[d.product].qty += d.qty;
    prods[d.product].orders++;
    if(d.status==='Returned') prods[d.product].returns++;
    cats[d.category]=(cats[d.category]||0)+getRevenue(d);
  });
  const sorted = Object.entries(prods).sort((a,b)=>b[1].rev-a[1].rev);

  destroyChart('prodBarChart');
  prodCharts.bar = new Chart(document.getElementById('prodBarChart'),{
    type:'bar',
    data:{labels:sorted.slice(0,10).map(([n])=>n.length>15?n.slice(0,15)+'‚Ä¶':n),
      datasets:[{label:'Revenue',data:sorted.slice(0,10).map(([,v])=>Math.round(v.rev)),backgroundColor:COLORS,borderRadius:6}]},
    options:{indexAxis:'y',responsive:true,plugins:{legend:{display:false}},scales:{x:{grid:{color:CHART_DEFAULTS.grid},ticks:{callback:v=>'‚Çπ'+v.toLocaleString('en-IN')}}}}
  });

  destroyChart('prodPieChart');
  prodCharts.pie = new Chart(document.getElementById('prodPieChart'),{
    type:'pie',
    data:{labels:Object.keys(cats),datasets:[{data:Object.values(cats).map(v=>Math.round(v)),backgroundColor:COLORS,borderWidth:0,hoverOffset:10}]},
    options:{responsive:true,plugins:{legend:{position:'right'}}}
  });

  const rows = sorted.map(([name,v],i)=>`
    <tr><td><div class="product-rank ${i===0?'rank-1':i===1?'rank-2':i===2?'rank-3':'rank-n'}" style="display:inline-flex;margin-right:6px">${i+1}</div>${name}</td>
    <td>${v.category}</td><td>${fmt(Math.round(v.rev))}</td><td>${v.qty}</td><td>${v.orders}</td>
    <td><span class="badge ${v.returns===0?'badge-success':'badge-error'}">${v.returns===0?'‚úì Good':'‚ö† '+v.returns+' returns'}</span></td></tr>
  `);
  document.getElementById('prodTable').innerHTML = `<table><thead><tr><th>PRODUCT</th><th>CATEGORY</th><th>REVENUE</th><th>QTY SOLD</th><th>ORDERS</th><th>RETURNS</th></tr></thead><tbody>${rows.join('')}</tbody></table>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CUSTOMERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let custCharts = {};
function renderCustomers(){
  const custs = {};
  salesData.forEach(d=>{
    custs[d.customer]=custs[d.customer]||{orders:0,rev:0,lastDate:d.date,regions:new Set()};
    custs[d.customer].orders++;
    custs[d.customer].rev+=getRevenue(d);
    custs[d.customer].regions.add(d.region);
    if(d.date>custs[d.customer].lastDate) custs[d.customer].lastDate=d.date;
  });
  const list = Object.entries(custs).map(([n,v])=>{
    const days = (new Date()-new Date(v.lastDate))/(86400000);
    let seg = days<30&&v.rev>20000?'Premium':days>60?'At-Risk':v.orders>2?'Regular':'New';
    return {...v,name:n,segment:seg};
  });
  const premium = list.filter(c=>c.segment==='Premium').length;
  const regular = list.filter(c=>c.segment==='Regular').length;
  const atrisk = list.filter(c=>c.segment==='At-Risk').length;
  const newc = list.filter(c=>c.segment==='New').length;

  document.getElementById('cust-total').textContent = list.length;
  document.getElementById('cust-premium').textContent = premium;
  document.getElementById('cust-regular').textContent = regular;
  document.getElementById('cust-atrisk').textContent = atrisk;

  destroyChart('custSegChart');
  custCharts.seg = new Chart(document.getElementById('custSegChart'),{
    type:'doughnut',
    data:{labels:['Premium','Regular','At-Risk','New'],datasets:[{data:[premium,regular,atrisk,newc],backgroundColor:['#ffd166','#4f8dff','#ff6b6b','#00e5c3'],borderWidth:0}]},
    options:{responsive:true,plugins:{legend:{position:'bottom'}},cutout:'55%'}
  });

  const freqBuckets = {'1 order':0,'2-3 orders':0,'4+ orders':0};
  list.forEach(c=>{if(c.orders===1)freqBuckets['1 order']++;else if(c.orders<=3)freqBuckets['2-3 orders']++;else freqBuckets['4+ orders']++;});
  destroyChart('custFreqChart');
  custCharts.freq = new Chart(document.getElementById('custFreqChart'),{
    type:'bar',
    data:{labels:Object.keys(freqBuckets),datasets:[{label:'Customers',data:Object.values(freqBuckets),backgroundColor:['rgba(79,141,255,.6)','rgba(0,229,195,.6)','rgba(255,209,102,.6)'],borderRadius:8}]},
    options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{grid:{color:CHART_DEFAULTS.grid}}}}
  });

  const rows = list.sort((a,b)=>b.rev-a.rev).map(c=>`
    <tr><td>${c.name}</td><td>${c.orders}</td><td>${fmt(Math.round(c.rev))}</td><td>${fmt(Math.round(c.rev/c.orders))}</td>
    <td>${c.lastDate}</td><td><span class="badge ${c.segment==='Premium'?'badge-warning':c.segment==='At-Risk'?'badge-error':c.segment==='New'?'badge-success':'badge-info'}">${c.segment}</span></td></tr>
  `);
  document.getElementById('custTable').innerHTML = `<table><thead><tr><th>CUSTOMER</th><th>ORDERS</th><th>TOTAL SPEND</th><th>AVG ORDER</th><th>LAST ORDER</th><th>SEGMENT</th></tr></thead><tbody>${rows.join('')}</tbody></table>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  REGIONAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let regCharts = {};
function renderRegional(){
  const stateRev = {};
  const regionRev = {};
  salesData.forEach(d=>{
    const s=d.state||'Unknown';
    stateRev[s]=(stateRev[s]||0)+getRevenue(d);
    regionRev[d.region]=(regionRev[d.region]||0)+getRevenue(d);
  });
  const sortedStates = Object.entries(stateRev).sort((a,b)=>b[1]-a[1]);

  destroyChart('regBarChart');
  regCharts.bar = new Chart(document.getElementById('regBarChart'),{
    type:'bar',
    data:{labels:sortedStates.map(([s])=>s),datasets:[{label:'Revenue',data:sortedStates.map(([,v])=>Math.round(v)),backgroundColor:COLORS,borderRadius:6}]},
    options:{indexAxis:'y',responsive:true,plugins:{legend:{display:false}},scales:{x:{grid:{color:CHART_DEFAULTS.grid},ticks:{callback:v=>'‚Çπ'+v.toLocaleString('en-IN')}}}}
  });

  destroyChart('regPieChart');
  regCharts.pie = new Chart(document.getElementById('regPieChart'),{
    type:'pie',
    data:{labels:Object.keys(regionRev),datasets:[{data:Object.values(regionRev).map(v=>Math.round(v)),backgroundColor:COLORS,borderWidth:0}]},
    options:{responsive:true,plugins:{legend:{position:'bottom'}}}
  });

  const rows = sortedStates.map(([state,rev],i)=>{
    const reg = salesData.find(d=>d.state===state)?.region||'‚Äî';
    const orders = salesData.filter(d=>d.state===state).length;
    return `<tr><td>${i+1}</td><td>${state}</td><td>${reg}</td><td>${orders}</td><td>${fmt(Math.round(rev))}</td><td>${fmt(Math.round(rev/orders))}</td></tr>`;
  });
  document.getElementById('regTable').innerHTML = `<table><thead><tr><th>#</th><th>STATE</th><th>REGION</th><th>ORDERS</th><th>REVENUE</th><th>AVG/ORDER</th></tr></thead><tbody>${rows.join('')}</tbody></table>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FORECAST (Linear Regression)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let fcCharts = {};
function linearForecast(data,steps){
  const n=data.length;
  const x=data.map((_,i)=>i);
  const xm=x.reduce((a,b)=>a+b)/n;
  const ym=data.reduce((a,b)=>a+b)/n;
  const slope=x.reduce((s,xi,i)=>s+(xi-xm)*(data[i]-ym),0)/x.reduce((s,xi)=>s+(xi-xm)**2,0);
  const intercept=ym-slope*xm;
  const forecast=[];
  for(let i=n;i<n+steps;i++) forecast.push(Math.max(0,Math.round(intercept+slope*i)));
  return{slope,intercept,forecast};
}
function renderForecast(){
  const monthRev=Array(6).fill(0);
  salesData.forEach(d=>{const m=new Date(d.date).getMonth();if(m<6)monthRev[m]+=getRevenue(d);});
  const {forecast} = linearForecast(monthRev,3);

  // KPIs
  const total3 = forecast.reduce((a,b)=>a+b,0);
  const best = Math.max(...forecast);
  document.getElementById('forecastKPIs').innerHTML = [
    {label:'JULY FORECAST',val:fmt(forecast[0])},
    {label:'AUGUST FORECAST',val:fmt(forecast[1])},
    {label:'SEPTEMBER FORECAST',val:fmt(forecast[2])},
  ].map(f=>`<div class="forecast-stat"><div class="forecast-val">${f.val}</div><div class="forecast-label">${f.label}</div></div>`).join('');

  destroyChart('forecastChart');
  const allLabels = [...months.slice(0,6),'Jul ‚ñ∂','Aug ‚ñ∂','Sep ‚ñ∂'];
  const allActual = [...monthRev,...Array(3).fill(null)];
  const allForecast = [...Array(6).fill(null),...forecast];
  const confidenceHigh = [...Array(6).fill(null),...forecast.map(v=>Math.round(v*1.1))];
  const confidenceLow = [...Array(6).fill(null),...forecast.map(v=>Math.round(v*0.9))];

  fcCharts.main = new Chart(document.getElementById('forecastChart'),{
    type:'line',
    data:{labels:allLabels,datasets:[
      {label:'Actual',data:allActual,borderColor:'#4f8dff',backgroundColor:'rgba(79,141,255,.15)',tension:.4,fill:true,pointRadius:5},
      {label:'Forecast',data:allForecast,borderColor:'#00e5c3',backgroundColor:'rgba(0,229,195,.15)',tension:.4,fill:true,pointRadius:5,borderDash:[6,3]},
      {label:'Upper Bound',data:confidenceHigh,borderColor:'rgba(0,229,195,.2)',fill:false,pointRadius:0,borderDash:[2,4]},
      {label:'Lower Bound',data:confidenceLow,borderColor:'rgba(0,229,195,.2)',fill:'-1',backgroundColor:'rgba(0,229,195,.05)',pointRadius:0,borderDash:[2,4]},
    ]},
    options:{responsive:true,plugins:{legend:{position:'top'}},scales:{y:{grid:{color:CHART_DEFAULTS.grid},ticks:{callback:v=>'‚Çπ'+v.toLocaleString('en-IN')}}}}
  });

  // Category forecast
  const cats = {};
  salesData.forEach(d=>{cats[d.category]=(cats[d.category]||0)+getRevenue(d);});
  const growth = 0.18;
  destroyChart('forecastCatChart');
  fcCharts.cat = new Chart(document.getElementById('forecastCatChart'),{
    type:'bar',
    data:{labels:Object.keys(cats),datasets:[
      {label:'Current (6m)',data:Object.values(cats).map(v=>Math.round(v)),backgroundColor:COLORS.map(c=>c+'88'),borderRadius:6},
      {label:'Forecast (next 3m)',data:Object.values(cats).map(v=>Math.round(v*(growth+0.5))),backgroundColor:COLORS,borderRadius:6},
    ]},
    options:{responsive:true,plugins:{legend:{position:'top'}},scales:{y:{grid:{color:CHART_DEFAULTS.grid},ticks:{callback:v=>'‚Çπ'+v.toLocaleString('en-IN')}}}}
  });

  // Table
  const rows = ['July','August','September'].map((mo,i)=>{
    const f=forecast[i],lo=Math.round(f*.9),hi=Math.round(f*1.1);
    return `<tr><td>${mo} 2025</td><td style="color:#00e5c3;font-weight:700">${fmt(f)}</td><td>${fmt(lo)}</td><td>${fmt(hi)}</td><td><span class="badge badge-success">‚ñ≤ Growing</span></td></tr>`;
  });
  document.getElementById('forecastTable').innerHTML = `<table><thead><tr><th>MONTH</th><th>FORECAST</th><th>LOW</th><th>HIGH</th><th>TREND</th></tr></thead><tbody>${rows.join('')}</tbody></table>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INSERT DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderInsert(){
  // Set default date
  document.getElementById('f-date').value = new Date().toISOString().split('T')[0];
  document.getElementById('f-orderid').value = 'ORD-'+(1000+salesData.length+1);
  renderInsertPreview();
}

function renderInsertPreview(){
  const last5 = salesData.slice(-5).reverse();
  document.getElementById('insertPreviewTable').innerHTML = makeTable(last5);
}

function insertRecord(){
  const date=document.getElementById('f-date').value;
  const orderid=document.getElementById('f-orderid').value.trim();
  const product=document.getElementById('f-product').value.trim();
  const category=document.getElementById('f-category').value;
  const qty=parseInt(document.getElementById('f-qty').value)||0;
  const price=parseFloat(document.getElementById('f-price').value)||0;
  const customer=document.getElementById('f-customer').value.trim()||'‚Äî';
  const region=document.getElementById('f-region').value;
  const state=document.getElementById('f-state').value.trim()||'‚Äî';
  const payment=document.getElementById('f-payment').value;
  const status=document.getElementById('f-status').value;
  const discount=parseFloat(document.getElementById('f-discount').value)||0;

  const err=[];
  if(!date) err.push('Date');
  if(!orderid) err.push('Order ID');
  if(!product) err.push('Product');
  if(!category) err.push('Category');
  if(!qty||qty<1) err.push('Quantity');
  if(!price||price<=0) err.push('Price');
  if(!region) err.push('Region');

  const alert = document.getElementById('insertAlert');
  if(err.length){alert.className='alert alert-error';alert.textContent='‚ö† Please fill: '+err.join(', ');alert.classList.remove('hidden');return;}

  salesData.push({date,orderid,product,category,qty,price,customer,region,state,payment,status,discount});
  alert.className='alert alert-success';
  alert.textContent='‚úì Record saved! Order '+orderid+' ‚Äî '+product+' (‚Çπ'+fmt(price*qty)+') added successfully.';
  alert.classList.remove('hidden');
  document.getElementById('f-orderid').value='ORD-'+(1000+salesData.length+1);
  document.getElementById('f-product').value='';
  document.getElementById('f-qty').value='';
  document.getElementById('f-price').value='';
  document.getElementById('f-customer').value='';
  document.getElementById('f-state').value='';
  renderInsertPreview();
  setTimeout(()=>alert.classList.add('hidden'),4000);
}

function clearForm(){
  ['f-product','f-qty','f-price','f-customer','f-state','f-discount'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('f-category').value='';
  document.getElementById('f-region').value='';
  document.getElementById('insertAlert').classList.add('hidden');
}

function handleCSV(event){
  const file = event.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = e=>{
    const lines = e.target.result.split('\n').filter(l=>l.trim());
    const header = lines[0].split(',').map(h=>h.trim().toLowerCase());
    let added=0, skipped=0;
    for(let i=1;i<lines.length;i++){
      const vals = lines[i].split(',');
      const row = {};
      header.forEach((h,j)=>row[h]=vals[j]?.trim()||'');
      if(!row.date||!row.product||!row.category) {skipped++;continue;}
      salesData.push({
        date:row.date, orderid:row.orderid||'ORD-CSV-'+i,
        product:row.product, category:row.category,
        qty:parseInt(row.qty)||1, price:parseFloat(row.price)||0,
        customer:row.customer||'‚Äî', region:row.region||'North',
        state:row.state||'‚Äî', payment:row.payment||'UPI',
        status:row.status||'Completed', discount:parseFloat(row.discount)||0,
      });
      added++;
    }
    const a = document.getElementById('csvAlert');
    a.className = added>0?'alert alert-success':'alert alert-error';
    a.textContent = added>0?`‚úì ${added} records imported successfully! ${skipped} skipped.`:'‚úó No valid records found.';
    a.classList.remove('hidden');
    renderInsertPreview();
    event.target.value='';
  };
  reader.readAsText(file);
}

function downloadSampleCSV(){
  const header='date,orderid,product,category,qty,price,customer,region,state,payment,status,discount';
  const sample=[
    '2025-07-01,ORD-2001,Sample Product,Electronics,2,5000,John Doe,North,Delhi,UPI,Completed,0',
    '2025-07-05,ORD-2002,Casual T-Shirt,Clothing,3,800,Jane Smith,West,Maharashtra,Credit Card,Completed,10',
  ].join('\n');
  const blob = new Blob([header+'\n'+sample],{type:'text/csv'});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='sample_sales.csv'; a.click();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RECORDS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderRecords(){
  filterRecords();
  document.getElementById('recordCount').textContent = salesData.length+' total entries';
}

function filterRecords(){
  const search = document.getElementById('searchInput').value.toLowerCase();
  const cat = document.getElementById('filterCat').value;
  const filtered = salesData.filter(d=>{
    const matchSearch = !search || Object.values(d).some(v=>String(v).toLowerCase().includes(search));
    const matchCat = !cat || d.category===cat;
    return matchSearch && matchCat;
  }).reverse();
  document.getElementById('recordsTableEl').innerHTML = makeTable(filtered, true);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  REPORTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  REPORTS & EMAIL ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderReports(){
  const rev    = salesData.reduce((s,d)=>s+getRevenue(d),0);
  const orders = salesData.length;
  const aov    = orders ? rev/orders : 0;

  // category breakdown
  const cats = {};
  salesData.forEach(d=>{cats[d.category]=(cats[d.category]||0)+getRevenue(d);});
  const topCat = Object.entries(cats).sort((a,b)=>b[1]-a[1])[0]?.[0]||'‚Äî';

  // region breakdown
  const regs = {};
  salesData.forEach(d=>{regs[d.region]=(regs[d.region]||0)+getRevenue(d);});
  const topReg = Object.entries(regs).sort((a,b)=>b[1]-a[1])[0]?.[0]||'‚Äî';

  // top products
  const prods = {};
  salesData.forEach(d=>{prods[d.product]=(prods[d.product]||0)+getRevenue(d);});
  const topProds = Object.entries(prods).sort((a,b)=>b[1]-a[1]).slice(0,5);

  // monthly
  const monthRev = Array(12).fill(0);
  salesData.forEach(d=>{const m=new Date(d.date).getMonth();monthRev[m]+=getRevenue(d);});
  const months6 = ['Jan','Feb','Mar','Apr','May','Jun'];

  // returned / pending counts
  const returned = salesData.filter(d=>d.status==='Returned').length;
  const pending  = salesData.filter(d=>d.status==='Pending').length;

  // quick snap in card
  document.getElementById('quickStatsSnap').innerHTML =
    `Revenue: <b style="color:var(--accent2)">${fmt(Math.round(rev))}</b><br>`+
    `Orders: <b style="color:var(--text)">${orders}</b><br>`+
    `AOV: <b style="color:var(--text)">${fmt(Math.round(aov))}</b><br>`+
    `Top: <b style="color:var(--accent)">${topCat}</b>`;

  // full summary
  document.getElementById('reportSummary').innerHTML = buildReportHTML(rev, orders, aov, topCat, topReg, topProds, monthRev, returned, pending);

  // Set default email subject
  const today = new Date().toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});
  document.getElementById('emailSubject').value = `Sales Analytics Report ‚Äî SalesIQ (${today})`;

  // Pre-fill email body
  refreshEmailPreview();
}

function buildReportText(rev, orders, aov, topCat, topReg, topProds, monthRev, returned, pending){
  const today = new Date().toLocaleString('en-IN');
  const m6 = ['Jan','Feb','Mar','Apr','May','Jun'];
  let txt = '';

  txt += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
  txt += '       SALESIQ ‚Äî ANALYTICS REPORT       \n';
  txt += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
  txt += `Generated  : ${today}\n`;
  txt += `Report By  : SalesIQ Analytics System\n\n`;

  if(document.getElementById('inclKPI')?.checked !== false){
    txt += 'üìä KPI SUMMARY\n';
    txt += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    txt += `Total Revenue      : ${fmt(Math.round(rev))}\n`;
    txt += `Total Orders       : ${orders}\n`;
    txt += `Avg Order Value    : ${fmt(Math.round(aov))}\n`;
    txt += `Completed Orders   : ${orders - returned - pending}\n`;
    txt += `Pending Orders     : ${pending}\n`;
    txt += `Returned Orders    : ${returned}\n`;
    txt += `Profit Margin (est): 28.4%\n\n`;
  }

  if(document.getElementById('inclRevenue')?.checked !== false){
    txt += 'üìà MONTHLY REVENUE (Jan‚ÄìJun 2025)\n';
    txt += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    m6.forEach((mo,i)=>{
      const bar = '‚ñà'.repeat(Math.round(monthRev[i]/Math.max(...monthRev)*20));
      txt += `${mo.padEnd(4)} : ${fmt(Math.round(monthRev[i])).padStart(12)}  ${bar}\n`;
    });
    txt += '\n';
  }

  if(document.getElementById('inclProducts')?.checked !== false){
    txt += 'üì¶ TOP 5 PRODUCTS BY REVENUE\n';
    txt += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    topProds.forEach(([name,val],i)=>{
      txt += `${i+1}. ${name.slice(0,28).padEnd(28)} ${fmt(Math.round(val))}\n`;
    });
    txt += '\n';
  }

  if(document.getElementById('inclRegional')?.checked !== false){
    const regs={};
    salesData.forEach(d=>{regs[d.region]=(regs[d.region]||0)+getRevenue(d);});
    txt += 'üó∫Ô∏è  REGIONAL BREAKDOWN\n';
    txt += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    Object.entries(regs).sort((a,b)=>b[1]-a[1]).forEach(([r,v])=>{
      txt += `${r.padEnd(12)}: ${fmt(Math.round(v))}\n`;
    });
    txt += '\n';
  }

  if(document.getElementById('inclForecast')?.checked !== false){
    const fc = linearForecastData(monthRev.slice(0,6),3);
    txt += 'üîÆ SALES FORECAST (Next 3 Months)\n';
    txt += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    ['July','August','September'].forEach((mo,i)=>{
      txt += `${mo.padEnd(12)}: ${fmt(fc[i])} (est.)\n`;
    });
    txt += '\n';
  }

  txt += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
  txt += 'This report was generated automatically\n';
  txt += 'by SalesIQ Analytics System.\n';
  txt += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
  return txt;
}

function buildReportHTML(rev, orders, aov, topCat, topReg, topProds, monthRev, returned, pending){
  const today = new Date().toLocaleString('en-IN');
  const m6 = ['Jan','Feb','Mar','Apr','May','Jun'];
  const maxM = Math.max(...monthRev.slice(0,6));
  return `
  <span style="color:var(--accent2)">‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</span><br>
  <b style="color:var(--text);font-size:14px">üìä SALESIQ ‚Äî ANALYTICS REPORT</b><br>
  <span style="color:var(--muted)">Generated: ${today}</span><br>
  <span style="color:var(--accent2)">‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</span><br><br>

  <b style="color:var(--text)">KPI SUMMARY</b><br>
  Total Revenue &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <b style="color:var(--accent2)">${fmt(Math.round(rev))}</b><br>
  Total Orders &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <b style="color:var(--text)">${orders}</b><br>
  Avg Order Value &nbsp;&nbsp;: <b style="color:var(--text)">${fmt(Math.round(aov))}</b><br>
  Pending Orders &nbsp;&nbsp;&nbsp;: <span style="color:var(--accent4)">${pending}</span><br>
  Returned Orders &nbsp;&nbsp;: <span style="color:var(--red)">${returned}</span><br>
  Top Category &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span style="color:var(--accent)">${topCat}</span><br>
  Top Region &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span style="color:var(--accent)">${topReg}</span><br><br>

  <b style="color:var(--text)">MONTHLY REVENUE</b><br>
  ${m6.map((mo,i)=>`${mo}: <b style="color:var(--accent2)">${fmt(Math.round(monthRev[i]))}</b>`).join(' &nbsp;|&nbsp; ')}<br><br>

  <b style="color:var(--text)">TOP 5 PRODUCTS</b><br>
  ${topProds.map(([n,v],i)=>`${i+1}. ${n} ‚Äî <b style="color:var(--accent2)">${fmt(Math.round(v))}</b>`).join('<br>')}<br><br>

  <span style="color:var(--accent2)">‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</span>
  `;
}

function linearForecastData(data, steps){
  const n=data.length, x=data.map((_,i)=>i);
  const xm=x.reduce((a,b)=>a+b)/n, ym=data.reduce((a,b)=>a+b)/n;
  const slope=x.reduce((s,xi,i)=>s+(xi-xm)*(data[i]-ym),0)/x.reduce((s,xi)=>s+(xi-xm)**2,0);
  const intercept=ym-slope*xm;
  return Array.from({length:steps},(_,i)=>Math.max(0,Math.round(intercept+slope*(n+i))));
}

function refreshEmailPreview(){
  const rev    = salesData.reduce((s,d)=>s+getRevenue(d),0);
  const orders = salesData.length;
  const aov    = orders ? rev/orders : 0;
  const cats={};salesData.forEach(d=>{cats[d.category]=(cats[d.category]||0)+getRevenue(d);});
  const topCat=Object.entries(cats).sort((a,b)=>b[1]-a[1])[0]?.[0]||'‚Äî';
  const regs={};salesData.forEach(d=>{regs[d.region]=(regs[d.region]||0)+getRevenue(d);});
  const topReg=Object.entries(regs).sort((a,b)=>b[1]-a[1])[0]?.[0]||'‚Äî';
  const prods={};salesData.forEach(d=>{prods[d.product]=(prods[d.product]||0)+getRevenue(d);});
  const topProds=Object.entries(prods).sort((a,b)=>b[1]-a[1]).slice(0,5);
  const monthRev=Array(12).fill(0);
  salesData.forEach(d=>{const m=new Date(d.date).getMonth();monthRev[m]+=getRevenue(d);});
  const returned=salesData.filter(d=>d.status==='Returned').length;
  const pending=salesData.filter(d=>d.status==='Pending').length;

  document.getElementById('emailBody').value =
    buildReportText(rev,orders,aov,topCat,topReg,topProds,monthRev,returned,pending);
}

function getEmailParts(){
  const to      = document.getElementById('emailTo').value.trim();
  const cc      = document.getElementById('emailCc').value.trim();
  const subject = document.getElementById('emailSubject').value.trim() || 'Sales Analytics Report ‚Äî SalesIQ';
  const body    = document.getElementById('emailBody').value;
  return {to, cc, subject, body};
}

function showEmailAlert(msg, type='success'){
  const el = document.getElementById('emailAlert');
  el.className = `alert alert-${type}`;
  el.textContent = msg;
  el.classList.remove('hidden');
  setTimeout(()=>el.classList.add('hidden'), 5000);
}

function sendEmailMailto(){
  const {to, cc, subject, body} = getEmailParts();
  if(!to){ showEmailAlert('‚ö† Please enter a recipient email address!','error'); return; }
  if(!to.includes('@')){ showEmailAlert('‚ö† Please enter a valid email address!','error'); return; }

  const params = new URLSearchParams();
  if(cc) params.set('cc', cc);
  params.set('subject', subject);
  params.set('body', body);

  const mailto = `mailto:${encodeURIComponent(to)}?${params.toString().replace(/\+/g,'%20')}`;
  window.location.href = mailto;
  showEmailAlert(`‚úì Opening your Mail app for ${to} ‚Äî compose window will appear shortly.`,'success');
}

function sendEmailGmail(){
  const {to, cc, subject, body} = getEmailParts();
  if(!to){ showEmailAlert('‚ö† Please enter a recipient email address!','error'); return; }
  if(!to.includes('@')){ showEmailAlert('‚ö† Please enter a valid email address!','error'); return; }

  const base = 'https://mail.google.com/mail/?view=cm&fs=1';
  const url  = base
    + '&to='      + encodeURIComponent(to)
    + (cc ? '&cc=' + encodeURIComponent(cc) : '')
    + '&su='      + encodeURIComponent(subject)
    + '&body='    + encodeURIComponent(body);

  window.open(url, '_blank');
  showEmailAlert(`‚úì Gmail opened in a new tab for ${to}.`,'success');
}

function copyEmailBody(){
  const body = document.getElementById('emailBody').value;
  if(!body){ showEmailAlert('‚ö† Nothing to copy. Click ‚Üª Refresh first.','error'); return; }
  navigator.clipboard.writeText(body)
    .then(()=> showEmailAlert('‚úì Email body copied to clipboard! Paste into any mail client.','success'))
    .catch(()=>{
      // fallback for older browsers
      const ta = document.getElementById('emailBody');
      ta.select();
      document.execCommand('copy');
      showEmailAlert('‚úì Copied! Paste into any mail client.','success');
    });
}

function downloadReportTxt(){
  const {subject, body} = getEmailParts();
  if(!body){ showEmailAlert('‚ö† Nothing to download. Click ‚Üª Refresh first.','error'); return; }
  const blob = new Blob([body],{type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'SalesIQ_Report_'+new Date().toISOString().slice(0,10)+'.txt';
  a.click();
  showEmailAlert('‚úì Report downloaded as .txt file!','success');
}

function sendReport(){
  // legacy alias ‚Äî now routes to mailto
  sendEmailMailto();
}

function printReport(){
  window.print();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TABLE HELPER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function makeTable(data, showDelete=false){
  if(!data.length) return '<p style="padding:20px;color:var(--muted);font-family:var(--mono);text-align:center">No records found</p>';
  const rows = data.map((d,i)=>{
    const rev = getRevenue(d);
    const statusBadge = d.status==='Completed'?'badge-success':d.status==='Pending'?'badge-warning':'badge-error';
    return `<tr>
      <td style="font-family:var(--mono);font-size:12px;color:var(--muted)">${d.orderid}</td>
      <td>${d.date}</td>
      <td>${d.product}</td>
      <td><span class="badge badge-info">${d.category}</span></td>
      <td style="font-family:var(--mono)">${d.qty}</td>
      <td style="font-family:var(--mono);color:var(--accent2)">${fmt(Math.round(rev))}</td>
      <td>${d.customer}</td>
      <td>${d.region}</td>
      <td><span class="badge ${statusBadge}">${d.status}</span></td>
      ${showDelete?`<td><button class="btn" style="padding:4px 10px;font-size:11px;background:rgba(239,68,68,.15);color:#ef4444;border-radius:6px" onclick="deleteRecord('${d.orderid}')">‚úï</button></td>`:''}
    </tr>`;
  });
  return `<table><thead><tr>
    <th>ORDER ID</th><th>DATE</th><th>PRODUCT</th><th>CATEGORY</th><th>QTY</th><th>REVENUE</th><th>CUSTOMER</th><th>REGION</th><th>STATUS</th>${showDelete?'<th>DEL</th>':''}
  </tr></thead><tbody>${rows.join('')}</tbody></table>`;
}

function deleteRecord(orderid){
  if(!confirm('Delete record '+orderid+'?')) return;
  salesData = salesData.filter(d=>d.orderid!==orderid);
  filterRecords();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  EXPORT CSV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportTableCSV(tableId){
  const header = ['OrderID','Date','Product','Category','Qty','Price','Revenue','Customer','Region','State','Payment','Status','Discount'];
  const rows = salesData.map(d=>[d.orderid,d.date,d.product,d.category,d.qty,d.price,Math.round(getRevenue(d)),d.customer,d.region,d.state,d.payment,d.status,d.discount]);
  const csv = [header,...rows].map(r=>r.join(',')).join('\n');
  const blob = new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='sales_data_export.csv'; a.click();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CHART DESTROY HELPER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function destroyChart(id){
  const existing = Chart.getChart(id);
  if(existing) existing.destroy();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.onload = ()=>{
  chartDefaults();
  updateDate();
  renderDashboard();
  initTheme();
};
</script>

<!-- ‚îÄ‚îÄ SETTINGS OVERLAY ‚îÄ‚îÄ -->
<div class="settings-overlay" id="settingsOverlay" onclick="closeSettings()"></div>

<!-- ‚îÄ‚îÄ SETTINGS PANEL ‚îÄ‚îÄ -->
<div class="settings-panel" id="settingsPanel">
  <div class="settings-head">
    <div class="settings-head-title">‚öôÔ∏è Appearance Settings</div>
    <button class="settings-close" onclick="closeSettings()">‚úï</button>
  </div>
  <div class="settings-body">

    <!-- THEME MODE -->
    <div class="settings-section">
      <div class="settings-section-title">THEME MODE</div>
      <div class="theme-cards">
        <div class="theme-card tp-dark selected" id="themeCardDark" onclick="setTheme('dark')">
          <div class="theme-preview">
            <div class="tp-sidebar"></div>
            <div class="tp-content"><div class="tp-bar"></div><div class="tp-bar2"></div><div class="tp-bar"></div></div>
          </div>
          <div class="theme-card-label">üåô Dark</div>
        </div>
        <div class="theme-card tp-light" id="themeCardLight" onclick="setTheme('light')">
          <div class="theme-preview">
            <div class="tp-sidebar"></div>
            <div class="tp-content"><div class="tp-bar"></div><div class="tp-bar2"></div><div class="tp-bar"></div></div>
          </div>
          <div class="theme-card-label">‚òÄÔ∏è Light</div>
        </div>
        <div class="theme-card tp-midnight" id="themeCardMidnight" onclick="setTheme('midnight')">
          <div class="theme-preview">
            <div class="tp-sidebar"></div>
            <div class="tp-content"><div class="tp-bar"></div><div class="tp-bar2"></div><div class="tp-bar"></div></div>
          </div>
          <div class="theme-card-label">üñ§ Midnight</div>
        </div>
      </div>
    </div>

    <!-- ACCENT COLOR -->
    <div class="settings-section">
      <div class="settings-section-title">ACCENT COLOUR</div>
      <div class="accent-swatches" id="accentSwatches">
        <div class="accent-swatch selected" data-accent="#4f8dff" style="background:#4f8dff" onclick="setAccent('#4f8dff','#00e5c3')" title="Blue"></div>
        <div class="accent-swatch" data-accent="#a855f7" style="background:#a855f7" onclick="setAccent('#a855f7','#e879f9')" title="Purple"></div>
        <div class="accent-swatch" data-accent="#22c55e" style="background:#22c55e" onclick="setAccent('#22c55e','#4ade80')" title="Green"></div>
        <div class="accent-swatch" data-accent="#f97316" style="background:#f97316" onclick="setAccent('#f97316','#ffd166')" title="Orange"></div>
        <div class="accent-swatch" data-accent="#ef4444" style="background:#ef4444" onclick="setAccent('#ef4444','#fb7185')" title="Red"></div>
        <div class="accent-swatch" data-accent="#06b6d4" style="background:#06b6d4" onclick="setAccent('#06b6d4','#00e5c3')" title="Cyan"></div>
        <div class="accent-swatch" data-accent="#f59e0b" style="background:#f59e0b" onclick="setAccent('#f59e0b','#ffd166')" title="Amber"></div>
        <div class="accent-swatch" data-accent="#ec4899" style="background:#ec4899" onclick="setAccent('#ec4899','#f0abfc')" title="Pink"></div>
      </div>
    </div>

    <!-- FONT SIZE -->
    <div class="settings-section">
      <div class="settings-section-title">FONT SIZE</div>
      <div class="font-slider-wrap">
        <span style="font-size:11px;color:var(--muted);font-family:var(--mono)">A</span>
        <input type="range" class="font-slider" id="fontSizeSlider" min="12" max="18" step="1" value="14" oninput="setFontSize(this.value)"/>
        <span style="font-size:16px;color:var(--muted);font-family:var(--mono)">A</span>
        <span class="font-size-label" id="fontSizeLabel">14px</span>
      </div>
    </div>

    <!-- LAYOUT -->
    <div class="settings-section">
      <div class="settings-section-title">LAYOUT DENSITY</div>
      <div class="layout-btns">
        <div class="layout-btn active" id="layoutComfy" onclick="setLayout('comfy')">
          <div class="lb-icon">‚ñ≠</div>Comfy
        </div>
        <div class="layout-btn" id="layoutCompact" onclick="setLayout('compact')">
          <div class="lb-icon">‚ñ¨</div>Compact
        </div>
      </div>
    </div>

    <!-- TOGGLES -->
    <div class="settings-section">
      <div class="settings-section-title">PREFERENCES</div>
      <div class="toggle-row">
        <div><div class="toggle-label">Smooth Animations</div><div class="toggle-sub">Card fade-in effects</div></div>
        <label class="toggle-switch"><input type="checkbox" id="togAnimations" checked onchange="toggleAnimations(this.checked)"><div class="toggle-track"></div></label>
      </div>
      <div class="toggle-row">
        <div><div class="toggle-label">Sidebar Labels</div><div class="toggle-sub">Show nav text labels</div></div>
        <label class="toggle-switch"><input type="checkbox" id="togLabels" checked onchange="toggleSidebarLabels(this.checked)"><div class="toggle-track"></div></label>
      </div>
      <div class="toggle-row">
        <div><div class="toggle-label">Live Indicator</div><div class="toggle-sub">Pulsing LIVE badge</div></div>
        <label class="toggle-switch"><input type="checkbox" id="togLive" checked onchange="toggleLive(this.checked)"><div class="toggle-track"></div></label>
      </div>
    </div>

    <button class="settings-reset" onclick="resetSettings()">‚Ü∫ Reset to Defaults</button>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  THEME ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentTheme  = 'dark';
let currentAccent = '#4f8dff';
let currentAccent2 = '#00e5c3';

function initTheme(){
  const saved = JSON.parse(localStorage.getItem('salesiq_settings')||'{}');
  if(saved.theme)   setTheme(saved.theme, true);
  if(saved.accent)  setAccent(saved.accent, saved.accent2||'#00e5c3', true);
  if(saved.fontSize) setFontSize(saved.fontSize, true);
  if(saved.layout)  setLayout(saved.layout, true);
  if(saved.animations===false) toggleAnimations(false, true);
  if(saved.labels===false)     toggleSidebarLabels(false, true);
  if(saved.live===false)       toggleLive(false, true);
}

function saveSettings(){
  const s = {
    theme: currentTheme,
    accent: currentAccent,
    accent2: currentAccent2,
    fontSize: document.getElementById('fontSizeSlider').value,
    layout: document.getElementById('layoutComfy').classList.contains('active') ? 'comfy' : 'compact',
    animations: document.getElementById('togAnimations').checked,
    labels: document.getElementById('togLabels').checked,
    live: document.getElementById('togLive').checked,
  };
  localStorage.setItem('salesiq_settings', JSON.stringify(s));
}

function setTheme(theme, silent=false){
  currentTheme = theme;
  document.documentElement.setAttribute('data-theme', theme);

  // Update quick toggle buttons
  document.getElementById('btnDark').classList.toggle('active', theme==='dark'||theme==='midnight');
  document.getElementById('btnLight').classList.toggle('active', theme==='light');
  if(theme==='dark')     { document.getElementById('btnDark').textContent='üåô Dark'; }
  if(theme==='midnight') { document.getElementById('btnDark').textContent='üñ§ Midnight'; }
  if(theme==='light')    { document.getElementById('btnLight').classList.add('active'); document.getElementById('btnDark').classList.remove('active'); document.getElementById('btnDark').textContent='üåô Dark'; }

  // Update theme cards
  ['Dark','Light','Midnight'].forEach(t=>{
    const card = document.getElementById('themeCard'+t);
    if(card) card.classList.toggle('selected', theme===t.toLowerCase());
  });

  // Update Chart.js colors
  updateChartTheme();
  if(!silent) saveSettings();
}

function setAccent(color, color2='#00e5c3', silent=false){
  currentAccent  = color;
  currentAccent2 = color2;
  document.documentElement.style.setProperty('--accent',  color);
  document.documentElement.style.setProperty('--accent2', color2);

  // Update swatch selection
  document.querySelectorAll('.accent-swatch').forEach(s=>{
    s.classList.toggle('selected', s.dataset.accent===color);
  });
  if(!silent) saveSettings();
}

function setFontSize(size, silent=false){
  document.documentElement.style.fontSize = size+'px';
  document.getElementById('fontSizeLabel').textContent = size+'px';
  document.getElementById('fontSizeSlider').value = size;
  if(!silent) saveSettings();
}

function setLayout(mode, silent=false){
  document.body.classList.toggle('compact', mode==='compact');
  document.getElementById('layoutComfy').classList.toggle('active',   mode==='comfy');
  document.getElementById('layoutCompact').classList.toggle('active', mode==='compact');
  if(!silent) saveSettings();
}

function toggleAnimations(on, silent=false){
  document.getElementById('togAnimations').checked = on;
  const style = document.getElementById('animStyleOverride');
  if(!on){
    if(!style){
      const s = document.createElement('style');
      s.id = 'animStyleOverride';
      s.textContent = '.page.active .kpi-card,.page.active .chart-card{animation:none!important}';
      document.head.appendChild(s);
    }
  } else {
    if(style) style.remove();
  }
  if(!silent) saveSettings();
}

function toggleSidebarLabels(on, silent=false){
  document.getElementById('togLabels').checked = on;
  document.querySelectorAll('.nav-item').forEach(item=>{
    const icon = item.querySelector('.nav-icon');
    const text = item.childNodes[item.childNodes.length-1];
    if(text && text.nodeType===3){
      text.textContent = on ? text.textContent.trim() || item.dataset.label || '' : '';
    }
  });
  if(!silent) saveSettings();
}

function toggleLive(on, silent=false){
  document.getElementById('togLive').checked = on;
  const badge = document.querySelector('.live-badge');
  if(badge) badge.style.display = on ? 'flex' : 'none';
  if(!silent) saveSettings();
}

function updateChartTheme(){
  const isDark = currentTheme !== 'light';
  const gridColor = isDark ? 'rgba(30,35,64,.7)' : 'rgba(200,205,230,.6)';
  const textColor = isDark ? '#636b9a' : '#7b82a8';
  Chart.defaults.color       = textColor;
  Chart.defaults.borderColor = gridColor;
  // Re-render current page charts
  Chart.instances && Object.values(Chart.instances).forEach(c => {
    if(c.options?.scales){
      Object.values(c.options.scales).forEach(sc=>{
        if(sc.grid) sc.grid.color = gridColor;
        if(sc.ticks) sc.ticks.color = textColor;
      });
      c.update('none');
    }
  });
}

function openSettings(){
  document.getElementById('settingsPanel').classList.add('open');
  document.getElementById('settingsOverlay').classList.add('open');
}

function closeSettings(){
  document.getElementById('settingsPanel').classList.remove('open');
  document.getElementById('settingsOverlay').classList.remove('open');
}

function resetSettings(){
  localStorage.removeItem('salesiq_settings');
  setTheme('dark');
  setAccent('#4f8dff','#00e5c3');
  setFontSize(14);
  setLayout('comfy');
  toggleAnimations(true);
  toggleSidebarLabels(true);
  toggleLive(true);
}
</script>
</body>
</html>
